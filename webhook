local WEBHOOK_URL = "https://discord.com/api/webhooks/1414247725259821172/c9k-3kUbH1aUE5XOWP1yvaw-InLrXRjhb0ftcZW1fuFYqxLfcCJbp9ml0Y6OagZgDS6P" -- <- ganti jika perlu

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")

-- Ambil LocalPlayer
local plr = Players.LocalPlayer
if not plr then
    pcall(function()
        plr = Players:WaitForChild("LocalPlayer", 5)
    end)
end

local playerName, playerId, displayName = "Unknown", 0, "Unknown"
if plr then
    pcall(function()
        playerName = plr.Name or "Unknown"
        playerId = plr.UserId or 0
        displayName = plr.DisplayName or playerName
    end)
end

-- JobId (server instance)
local jobId = "Unknown"
pcall(function()
    if game.JobId and tostring(game.JobId) ~= "" then
        jobId = tostring(game.JobId)
    end
end)

-- Deteksi executor
local function detect_executor()
    if type(identifyexecutor) == "function" then
        local ok, res = pcall(identifyexecutor)
        if ok and res then return tostring(res) end
    end
    if syn and syn.request then return "Synapse X" end
    if KRNL_LOADED or type(kronos) == "table" then return "Krnl" end
    if fluxus and fluxus.request then return "Fluxus" end
    if secure_load then return "Sentinel / Secure" end
    if is_sirhurt_closure then return "SirHurt" end
    if PROTOSMASHER_LOADED then return "ProtoSmasher" end
    if OXYGEN then return "Oxygen" end
    if exploit and exploit.request then return "UnknownExploit (exploit.request)" end
    return "Unknown/Undetected"
end

local executorName = detect_executor()

-- Nama game
local placeName = "Unknown"
pcall(function()
    local ok, info = pcall(function()
        return MarketplaceService:GetProductInfo(game.PlaceId)
    end)
    if ok and info and info.Name then
        placeName = info.Name
    end
end)

-- Embed dengan warna acak dan triple backticks
local embed = {
    title = "Script Executed",
    color = math.random(0, 16777215), -- Warna acak
    fields = {
        { name = "Player Name", value = "```"..tostring(playerName).."```", inline = true },
        { name = "Display Name", value = "```"..tostring(displayName).."```", inline = true },
        { name = "UserId", value = "```"..tostring(playerId).."```", inline = true },
        { name = "Executor", value = "```"..tostring(executorName).."```", inline = true },
        { name = "PlaceId", value = "```"..tostring(game.PlaceId or "Unknown").."```", inline = true },
        { name = "Game Name", value = "```"..tostring(placeName).."```", inline = false },
        { name = "JobId", value = "```"..tostring(jobId).."```", inline = false }
    },
    timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
}

local payload_table = {
    content = ("```Script executed by: %s (ID: %s) — Executor: %s — JobId: %s```"):format(playerName, playerId, executorName, jobId),
    embeds = { embed }
}
local body = HttpService:JSONEncode(payload_table)

-- Request wrapper
local function try_send(opts)
    local ok, res
    if syn and syn.request then ok,res=pcall(syn.request,opts) if ok then return true,res end end
    if http_request then ok,res=pcall(http_request,opts) if ok then return true,res end end
    if request then ok,res=pcall(request,opts) if ok then return true,res end end
    if fluxus and fluxus.request then ok,res=pcall(fluxus.request,opts) if ok then return true,res end end
    if exploit and exploit.request then ok,res=pcall(exploit.request,opts) if ok then return true,res end end
    return false,"No supported request function"
end

-- Kirim webhook awal (saat script dijalankan)
local ok, res = try_send({
    Url = WEBHOOK_URL,
    Method = "POST",
    Headers = { ["Content-Type"] = "application/json" },
    Body = body
})

if ok then

else
    warn("Gagal kirim webhook:", res)
    print(body)
end
