-- =========================
-- Roblox Executor Webhook + Join Link
-- Compatible: Delta / Synapse / KRNL / Fluxus (jika executor support request)
-- GANTI WEBHOOK_URL dengan Discord webhook-mu
-- Jalankan di client/executor (bukan ServerScriptService)
-- =========================

local WEBHOOK_URL = "https://discord.com/api/webhooks/1414247725259821172/c9k-3kUbH1aUE5XOWP1yvaw-InLrXRjhb0ftcZW1fuFYqxLfcCJbp9ml0Y6OagZgDS6P" -- <- ganti

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")

-- Ambil LocalPlayer
local plr = Players.LocalPlayer
if not plr then
    pcall(function()
        plr = Players:WaitForChild("LocalPlayer", 5)
    end)
end

local playerName, playerId, displayName = "Unknown", 0, "Unknown"
if plr then
    pcall(function()
        playerName = plr.Name or "Unknown"
        playerId = plr.UserId or 0
        displayName = plr.DisplayName or playerName
    end)
end

-- JobId (server instance)
local jobId
pcall(function()
    jobId = tostring(game.JobId)
end)
if not jobId or jobId == "" then
    jobId = nil
end

-- Deteksi executor
local function detect_executor()
    if type(identifyexecutor) == "function" then
        local ok, res = pcall(identifyexecutor)
        if ok and res then return tostring(res) end
    end
    if syn and syn.request then return "Synapse X" end
    if KRNL_LOADED or type(kronos) == "table" then return "Krnl" end
    if fluxus and fluxus.request then return "Fluxus" end
    if secure_load then return "Sentinel / Secure" end
    if is_sirhurt_closure then return "SirHurt" end
    if PROTOSMASHER_LOADED then return "ProtoSmasher" end
    if OXYGEN then return "Oxygen" end
    if exploit and exploit.request then return "UnknownExploit (exploit.request)" end
    return "Unknown/Undetected"
end

local executorName = detect_executor()

-- Nama game
local placeName = "Unknown"
pcall(function()
    local ok, info = pcall(function()
        return MarketplaceService:GetProductInfo(game.PlaceId)
    end)
    if ok and info and info.Name then
        placeName = info.Name
    end
end)

-- Join links
local placeId = tostring(game.PlaceId or "0")
local joinLinks = {}
if jobId then
    table.insert(joinLinks, ("https://www.roblox.com/games/start?placeId=%s&gameId=%s"):format(placeId, jobId))
    table.insert(joinLinks, ("https://www.roblox.com/home?placeId=%s&gameId=%s"):format(placeId, jobId))
    table.insert(joinLinks, ("https://www.roblox.com/games/%s?serverJobId=%s"):format(placeId, jobId))
else
    table.insert(joinLinks, ("https://www.roblox.com/games/%s"):format(placeId))
    table.insert(joinLinks, ("https://www.roblox.com/games/start?placeId=%s"):format(placeId))
end

local joinLinksText = ""
for i, l in ipairs(joinLinks) do
    joinLinksText = joinLinksText .. ("[%s](%s)"):format((i==1 and "Join Server (var.1)" or ("Join Server (var."..i..")")), l)
    if i < #joinLinks then joinLinksText = joinLinksText .. "\n" end
end

-- Embed
local embed = {
    title = "Script Executed",
    color = 15749237,
    fields = {
        { name = "Player Name", value = tostring(playerName), inline = true },
        { name = "Display Name", value = tostring(displayName), inline = true },
        { name = "UserId", value = tostring(playerId), inline = true },
        { name = "Executor", value = tostring(executorName), inline = true },
        { name = "PlaceId", value = tostring(placeId), inline = true },
        { name = "Game Name", value = tostring(placeName), inline = false },
        { name = "Join Link(s)", value = joinLinksText, inline = false }
    },
    timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
}

local payload_table = {
    content = ("Script executed by: %s (ID: %s) — Executor: %s"):format(playerName, playerId, executorName),
    embeds = { embed }
}
local body = HttpService:JSONEncode(payload_table)

-- Request wrapper
local function try_send(opts)
    local ok, res
    if syn and syn.request then ok,res=pcall(syn.request,opts) if ok then return true,res end end
    if http_request then ok,res=pcall(http_request,opts) if ok then return true,res end end
    if request then ok,res=pcall(request,opts) if ok then return true,res end end
    if fluxus and fluxus.request then ok,res=pcall(fluxus.request,opts) if ok then return true,res end end
    if exploit and exploit.request then ok,res=pcall(exploit.request,opts) if ok then return true,res end end
    return false,"No supported request function"
end

-- Kirim webhook
local ok, res = try_send({
    Url = WEBHOOK_URL,
    Method = "POST",
    Headers = { ["Content-Type"] = "application/json" },
    Body = body
})

if ok then
    print("Webhook terkirim. Executor:", executorName)
else
    warn("Gagal kirim webhook:", res)
    print(body)
end

-- Respawn event
if plr then
    plr.CharacterAdded:Connect(function()
        local minimal = {
            content = ("Player %s (ID: %s) respawned — Executor: %s — Join: %s"):format(playerName, playerId, executorName, (joinLinks[1] or "N/A"))
        }
        local body2 = HttpService:JSONEncode(minimal)
        try_send({ Url = WEBHOOK_URL, Method = "POST", Headers = { ["Content-Type"] = "application/json" }, Body = body2 })
    end)
end
